---
import Layout from "../layouts/Layout.astro";
import { emoticons, categoryInfo, type Category } from "../data/emoticons";
import EmoticonCard from "../components/EmoticonCard.astro";
import Sidenav from "../components/Sidenav.astro";

// Group emoticons by category
const groupedEmoticons = Object.entries(categoryInfo).reduce(
  (acc, [category]) => {
    const categoryKey = category as Category;
    const emoticonsByCategory = emoticons.filter(
      (e) => e.category === categoryKey
    );
    if (emoticonsByCategory.length > 0) {
      acc.push({
        category: categoryKey,
        emoticons: emoticonsByCategory,
      });
    }
    return acc;
  },
  [] as Array<{ category: Category; emoticons: typeof emoticons }>
);
---

<Layout>
  <div class="wrapper">
    <Sidenav groupedEmoticons={groupedEmoticons} />
    <main>
      <header class="about">
        <h1>Unbreakable emoticons</h1>
        <p>Copy-paste-ready emoticons that stay intact across lines!</p>
      </header>

      <div class="sections">
        {
          groupedEmoticons.map(({ category, emoticons: catEmoticons }) => (
            <section class="category-section" id={category}>
              <h2 class="category-title">
                <span class="category-emoji">
                  {categoryInfo[category].emoji}
                </span>
                <span>{categoryInfo[category].label}</span>
                <span class="emoticon-count">({catEmoticons.length})</span>
              </h2>
              <div class="gallery">
                {catEmoticons.map((emoticon) => (
                  <EmoticonCard emoticon={emoticon} />
                ))}
              </div>
            </section>
          ))
        }
      </div>
    </main>
  </div>
</Layout>

<script is:inline>
  const COPY_DURATION = 1500;

  function copyFromCard(card) {
    const text = card.dataset.emoticon;
    if (!text) return;

    navigator.clipboard.writeText(text);
    card.dataset.copied = "true";
    setTimeout(() => {
      card.dataset.copied = "false";
    }, COPY_DURATION);
  }

  document.addEventListener("click", (e) => {
    const card = e.target.closest(".card");
    if (!card) return;
    copyFromCard(card);
  });

  document.addEventListener("keydown", (e) => {
    if (e.key !== "Enter" && e.key !== " ") return;
    const card = e.target.closest(".card");
    if (!card) return;
    e.preventDefault();
    copyFromCard(card);
  });
</script>

<style>
  .wrapper {
    display: flex;
  }

  main {
    flex: 1 1 0%;
    max-width: 1180px;
    padding: 32px;
    margin-left: auto;
    margin-right: auto;
  }

  h1 {
    font-size: 3rem;
    background-image: linear-gradient(
      to right,
      rgb(236, 147, 191),
      rgb(224, 194, 240),
      rgb(179, 230, 213)
    );
    background-clip: text;
    -webkit-background-clip: text;
    color: transparent;
  }

  .about {
    text-align: center;
    margin-bottom: 48px;
  }

  .sections {
    display: flex;
    flex-direction: column;
    gap: 48px;
  }

  .category-section {
    display: flex;
    flex-direction: column;
    gap: 16px;
  }

  .category-title {
    font-size: 1.25rem;
    font-weight: 700;
    display: flex;
    align-items: center;
    gap: 8px;
    color: var(--accent-text-color);
  }

  .category-emoji {
    font-size: 1.5rem;
    font-weight: 500;
    display: inline-flex;
    align-items: center;
  }

  .emoticon-count {
    font-size: 0.875rem;
    font-weight: 400;
    color: #999;
  }

  .gallery {
    display: grid;
    gap: 16px;
    grid-template-columns: repeat(auto-fill, minmax(17rem, 1fr));
  }
</style>
